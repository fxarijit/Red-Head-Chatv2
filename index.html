<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Red Head Chat - Public</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
<script defer>
  const firebaseConfig = {
    apiKey: "AIzaSyA9Hyb4nv6yZcyOqI_azRLB0v31jdO3YvU",
    authDomain: "red-head-7391.firebaseapp.com",
    databaseURL: "https://red-head-7391-default-rtdb.firebaseio.com",
    projectId: "red-head-7391",
    storageBucket: "red-head-7391.firebasestorage.app",
    messagingSenderId: "408168002586",
    appId: "1:408168002586:web:f9920d13106cbe375b8da3",
    measurementId: "G-N6QX49H4KN"
  };
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const hardUsername = "Akash@9872";
  const hardPassword = "Akash@7391";

  function formatTime(ts) {
    const d = new Date(ts);
    const h = d.getHours().toString().padStart(2,'0');
    const m = d.getMinutes().toString().padStart(2,'0');
    return `${h}:${m}`;
  }

  function publicLogin() {
    const username = document.getElementById("publicUsername").value;
    const password = document.getElementById("publicPassword").value;
    if(username === hardUsername && password === hardPassword){
      alert("✅ Login Successful!");
      document.getElementById("publicAuth").classList.add("hidden");
      document.getElementById("publicChat").classList.remove("hidden");
      listenPublicChat();
    } else {
      alert("❌ Incorrect username or password!");
    }
  }

  function listenPublicChat() {
    const messagesRef = db.ref("chats/public/messages");
    messagesRef.on("child_added", (snapshot) => {
      const msg = snapshot.val();
      const div = document.createElement("div");
      div.className = "max-w-[75%] px-3 py-2 my-1 rounded-xl break-words";
      div.style.alignSelf = msg.sender === "admin" ? "flex-start" : "flex-end";
      div.style.backgroundColor = msg.sender === "admin" ? "#22c55e" : "#3b82f6";
      div.innerHTML = `<span class="font-semibold">${msg.sender}</span>: ${msg.text} <span class="text-xs opacity-70 ml-2">${formatTime(msg.timestamp)}</span>`;
      document.getElementById("messagesPublic").appendChild(div);
      document.getElementById("messagesPublic").scrollTop = document.getElementById("messagesPublic").scrollHeight;
    });
  }

  function sendPublicMsg() {
    const text = document.getElementById("publicMsg").value;
    if(!text) return;
    db.ref("chats/public/messages").push({ sender: "user", text, timestamp: Date.now() });
    document.getElementById("publicMsg").value = "";
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("loginButton").addEventListener("click", publicLogin);
    document.getElementById("sendButton").addEventListener("click", sendPublicMsg);
  });
</script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen">

<div class="w-full max-w-md p-4 flex flex-col">
  <h1 class="text-3xl font-bold text-center mb-4 text-cyan-400">💬 Red Head Chat</h1>

  <!-- Login -->
  <div id="publicAuth" class="space-y-2">
    <input id="publicUsername" type="text" placeholder="Username" class="w-full p-2 rounded bg-gray-800 placeholder-gray-400"/>
    <input id="publicPassword" type="password" placeholder="Password" class="w-full p-2 rounded bg-gray-800 placeholder-gray-400"/>
    <button id="loginButton" class="w-full bg-cyan-500 p-2 rounded hover:bg-cyan-400 transition">Login</button>
  </div>

  <!-- Chat -->
  <div id="publicChat" class="hidden flex flex-col flex-grow">
    <div id="messagesPublic" class="flex flex-col h-64 overflow-y-auto bg-gray-800 p-3 rounded mb-2"></div>
    <div class="flex">
      <input id="publicMsg" type="text" placeholder="Type a message..." class="flex-grow p-2 rounded-l bg-gray-700 placeholder-gray-400"/>
      <button id="sendButton" class="bg-blue-500 px-4 rounded-r hover:bg-blue-400 transition">Send</button>
    </div>
  </div>
</div>
</body>
</html>
